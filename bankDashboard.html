<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Page</title>
    <link rel="stylesheet" href="../bootstrap-5.2.2-dist/css/bootstrap.css">
</head>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'poppins', sans-serif;
    }

    .containerp {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .btnp {
        padding: 10px 60px;
        background: #fff;
        border: 0;
        outline: none;
        cursor: pointer;
        font-size: 22px;
        font-weight: 500;
        border-radius: 30px;
    }

    .popup {
        width: 400px;
        background: #fff;
        border-radius: 6px;
        position: absolute;
        top: 0;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.1);
        text-align: center;
        padding: 0 30px 30px;
        color: #333;
        visibility: hidden;
        transition: transform 0.4s, top 0.4s;
    }

    .open-popup {
        visibility: visible;
        top: 50%;
        transform: translate(-50%, -50%) scale(1);
    }

    .popup h2 {
        font-size: 38px;
        font-weight: 500;
        margin: 30px 0 10px;
    }

    .popup #button1 {
        width: 100%;
        margin-top: 50px;
        padding: 10px 0;
        background: #198754;
        color: #fff;
        border: 0;
        outline: none;
        font-size: 18px;
        border-radius: 4px;
        cursor: pointer;
        box-shadow: 0 5px 5px rgba(0, 0, 0, 0.2);
    }

    @media (max-width:700px) {
        .popup {
            width: 300px;
        }
    }
    @media (max-width: 768px) {
        .smallDeviceWidth {
            width: 100% !important;
        }
    }
</style>
<body style="height: 100vh;" onload="displayDetails()" class="overflow-hidden">
    <div class="smallDeviceWidth w-50 bg-dark rounded-5 h-100 d-block mx-auto">
        <div class="pt-3"><img src="../TODO APP/gift.png" alt="" style="height: 50px; width: 50px; border-radius: 50%;" class="ms-5 me-2"><h2 class="text-light d-inline" id="bankUserName"></h2><button class="ms-auto me-3 btn btn-info d-block">Sign Out</button></div>
        <div>
            <p class="text-light ms-5">Your balance <span onclick="showCardNumber()" class="float-end me-6">View Card Number</span></p>
            <h3 class="text-light ms-5">$<span id="userBalance"></span>.00</h3>
            <img src="../TODO APP/income.png" alt="" style="height: 200px;" class="w-75 rounded-5 d-block mx-auto">
        </div>
        <p class="text-light ps-5">Account Number: <span id="accountNumber"></span></p>
        <p>Transact</p>
        <div class="d-flex justify-content-around">
            <div onclick="deposit()">
            <img src="../TODO APP/more.png" alt="" style="height: 50px; width: 50px;">
            <p class="text-light">Deposit</p>
            </div>
            <div onclick="withdraw()">
            <img src="../TODO APP/more.png" alt="" style="height: 50px; width: 50px;">
            <p class="text-light">Withdraw</p>
            </div>
            <div onclick="openTransfer()">
            <img src="../TODO APP/more.png" alt="" style="height: 50px; width: 50px;">
            <p class="text-light">Transfer</p>
            </div>
        </div>
        <div class="text-light p-5">
            <h3>Recent History <a class="float-end me-0 me-sm-5" href="bankHistoryPage.html">View All</a></h3>
            <div id="historyDisplay"></div>
        </div>
    </div>
    <div class="containerp">
        <div class="popup" id="popup">
            <button type="button" class="btn-close ms-auto d-block my-2" onclick="closeTransferPopup()"
                aria-label="Close"></button>
            <p id="transferStatus" class="text-danger"></p>
            <input type="text" class="form-control my-2 mt-5" placeholder="Beneficiary Account Number" id="beneficiaryAccountNumber">
            <p id="beneficiaryName"></p>
            <select name="" id="beneficiaryBank" class="form-control my-2"  onchange="fetchName()">
                <option value="null" selected>Select Bank</option>
                <option value="PROADE">PROADE BANK</option>
                <option value="Zenith">Zenith Bank</option>
                <option value="Access">Access Bank</option>
                <option value="GT">GT Bank</option>
                <option value="Kuda">Kuda Microfinance Bank</option>
                <option value="OPay">OPay</option>
            </select>
            <input type="number" class="form-control my-2" placeholder="Amount" id="transferAmount">
            <input type="number" class="form-control my-2" placeholder="PIN" id="pin">
            <button type="button" id="button1" onclick="transfer()">Send</button>
        </div>
    </div>
    <div class="containerp">
        <div class="popup" id="popup2">
            <button type="button" class="btn-close ms-auto d-block my-2" onclick="closeDepositPopup2()"
                aria-label="Close"></button>
            <input type="number" class="form-control my-2" placeholder="Card Number" id="cardNumber2">
            <!-- <input type="number" class="form-control my-2" placeholder="Amount" id="depositAmount"> -->
            <input type="number" class="form-control my-2" placeholder="PIN" id="pin2">
            <button type="button" id="button1" onclick="closeDepositPopup()">Deposit</button>
        </div>
    </div>
    <div class="containerp">
        <div class="popup" id="popup3">
            <button type="button" class="btn-close ms-auto d-block my-2" onclick="closeWithdrawPopup()"
                aria-label="Close"></button>
            <input type="number" class="form-control my-2" placeholder="Enter your card number" id="cardNumber">
            <input type="number" class="form-control my-2" placeholder="Amount" id="withdrawAmount">
            <input type="number" class="form-control my-2" placeholder="PIN" id="pin3">
            <button type="button" id="button1" onclick="closeWithdrawPopup2()">Withdraw</button>
        </div>
    </div>
    <div class="containerp">
        <div class="popup" id="popup4">
            <button type="button" class="btn-close ms-auto d-block my-2" onclick="closeCardNumber()"
                aria-label="Close"></button>
            <p id="cardNumber16" class="text-danger"></p>
            <a href="createCard.html" id="createLink" class="d-none">Create here</a>
            <button type="button" id="button1" onclick="closeCardNumber()">Close</button>
        </div>
    </div>

    <script>
        let allBankUsers = JSON.parse(localStorage.getItem("allBankUsers"))
        let currentBankUserIndex = JSON.parse(localStorage.getItem("currentBankUserIndex"))
        const displayDetails =()=>{
            bankUserName.innerText = `${allBankUsers[currentBankUserIndex].firstName} ${allBankUsers[currentBankUserIndex].lastName}`
            userBalance.innerText = `${allBankUsers[currentBankUserIndex].accountBalance}`
            accountNumber.innerText = `${allBankUsers[currentBankUserIndex].accountNumber}`
            transactionsHistory()
        }
        const openTransfer =()=>{
            popup.classList.add("open-popup")
        }
        const fetchName = () => {
            if (beneficiaryBank.value=="PROADE") {
                allBankUsers.find((user, index)=>{
                if (user.accountNumber==beneficiaryAccountNumber.value) {
                    beneficiaryName.innerText = `Beneficiary:  ${user.firstName} ${user.lastName}`
                }
            })
            } else{
                transferStatus.innerText = `User not found under this bank`
                beneficiaryName.innerText = ""
                setTimeout(()=>transferStatus.innerText = "", 3000)
            }
        }
        const transfer = () => {
            if (allBankUsers[currentBankUserIndex].accountBalance>=transferAmount.value) {
                    if (beneficiaryBank.value=="PROADE") {
                        if (allBankUsers[currentBankUserIndex].pin==Number(pin.value)) {
                            // if (beneficiaryBank.value=="Proade") {
                                allBankUsers.map((user, index)=>{
                                if (user.accountNumber==beneficiaryAccountNumber.value) {
                                user.accountBalance += Number(transferAmount.value)
                                allBankUsers[currentBankUserIndex].accountBalance -= transferAmount.value
                                transactionDetails = {
                                    transactionAmount: `-${transferAmount.value}`,
                                    transactionBeneficiaryName: `${user.firstName} ${user.lastName}`,
                                    transactionDate : new Date(),
                                    transactionBeneficiaryBankName : beneficiaryBank.value,
                                    transactionStatus : "Successful"
                                }
                                allBankUsers[currentBankUserIndex].transactionHistory.push(transactionDetails)
                                localStorage.setItem("allBankUsers", JSON.stringify(allBankUsers))
                                alert("Success")
                                beneficiaryBank.value = "null"
                                pin.value = ""
                                transferAmount.value = ""
                                beneficiaryAccountNumber.value = ""
                                closeTransferPopup()
                                }
                                })
                            // }
                        } else{
                            transferStatus.innerText = `Wrong Pin`
                            setTimeout(()=>transferStatus.innerText = "", 3000)
                        }
                    } else{
                        transferStatus.innerText = `Working on other banks, you can only use PROADE BANK for now`
                        setTimeout(()=>transferStatus.innerText = "", 3000)
                    }
            } else{
                transferStatus.innerText = `Insufficient balance`
                setTimeout(()=>transferStatus.innerText = "", 3000)
            }
            displayDetails()
        }
        const closeTransferPopup =()=>{
            popup.classList.remove("open-popup")
        } 
        const closeTransferPopup2 = () => {
            popup.classList.remove("open-popup")
        }
        const deposit =()=>{
            popup2.classList.add("open-popup")
        }
        const closeDepositPopup = () => {
            let depositAmountCal = Math.round(Math.random()*100)+"000"
            if (allBankUsers[currentBankUserIndex].pin==pin2.value) {
                if (allBankUsers[currentBankUserIndex].cardNumber==cardNumber2.value) {
                    allBankUsers[currentBankUserIndex].accountBalance += Number(depositAmountCal)
                    transactionDetails = {
                                        transactionAmount: `+${depositAmountCal}`,
                                        transactionBeneficiaryName: `${allBankUsers[currentBankUserIndex].firstName} ${allBankUsers[currentBankUserIndex].lastName}`,
                                        transactionDate : new Date(),
                                        transactionBeneficiaryBankName : "PROADE",
                                        transactionStatus : "Successful"
                                    }
                    allBankUsers[currentBankUserIndex].transactionHistory.push(transactionDetails)
                    popup2.classList.remove("open-popup")
                    localStorage.setItem("allBankUsers", JSON.stringify(allBankUsers))
                    displayDetails()
                } else{
                    alert("Wrong card number")
                }
            } else{
                alert("Wrong pin")
            }
            
        }
        const closeDepositPopup2 = () => {
            popup2.classList.remove("open-popup")
        } 
        const transactionsHistory =()=>{
            historyDisplay.innerHTML = ""
            let bankHistory = allBankUsers[currentBankUserIndex].transactionHistory.reverse().filter((history, index)=>index<=3)
            bankHistory.map((history, index)=>{
                historyDisplay.innerHTML += `<p class="d-block text-light p-2 rounded-pill">${history.transactionBeneficiaryName} <span class="ms-3">${history.transactionAmount}</span> <span class="float-end me-1">${history.transactionBeneficiaryBankName}</span></p>`
            })
        }
        const closeWithdrawPopup =()=>{
            popup3.classList.remove("open-popup")
        } 
        const closeWithdrawPopup2 = () => {
            if (allBankUsers[currentBankUserIndex].cardNumber==cardNumber.value) {
                if (allBankUsers[currentBankUserIndex].accountBalance>=withdrawAmount.value) {
                    if (allBankUsers[currentBankUserIndex].pin==pin3.value) {
                        allBankUsers[currentBankUserIndex].accountBalance -= withdrawAmount.value
                        transactionDetails = {
                                    transactionAmount: `-${withdrawAmount.value}`,
                                    transactionBeneficiaryName: `${allBankUsers[currentBankUserIndex].firstName} ${allBankUsers[currentBankUserIndex].lastName}`,
                                    transactionDate : new Date(),
                                    transactionBeneficiaryBankName : "PROADE BANK",
                                    transactionStatus : "Successful"
                                }
                        allBankUsers[currentBankUserIndex].transactionHistory.push(transactionDetails)
                        localStorage.setItem("allBankUsers", JSON.stringify(allBankUsers))
                        alert("Success")
                        popup3.classList.remove("open-popup")
                        displayDetails()
                    } else{alert("Wrong pin")}
                } else{alert("Insufficient balance")}
            } else{alert("Wrong card number")}
            
        }
        const withdraw =()=>{
            popup3.classList.add("open-popup")
        }
        const showCardNumber = ()=>{
            if (allBankUsers[currentBankUserIndex].cardNumber) {
                cardNumber16.innerText = `Your card number:  ${allBankUsers[currentBankUserIndex].cardNumber}`
            } else{
                cardNumber16.innerText = `You are yet to create a card`
                createLink.className = "d-block" 
            }
            popup4.classList.add("open-popup")
        }
        const closeCardNumber = ()=>{
            popup4.classList.remove("open-popup")
        }
    </script>
</body>
</html>